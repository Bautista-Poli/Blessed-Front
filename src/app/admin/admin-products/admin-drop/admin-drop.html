<!-- src/app/admin/drops/admin-drops.html -->
<div class="drops-page">

  <!-- Topbar -->
  <div class="adm-topbar">
    <div>
      <h1 class="adm-title">Drops</h1>
      <p class="adm-subtitle">{{ drops().length }} drops en total Â· {{ activeDrops().length }} activos</p>
    </div>
    <button 
        class="adm-btn-add" [class.is-cancel]="showForm()" (click)="toggleForm()">
        @if (showForm()) { âœ• Cancelar }
        @else { + Nuevo drop }
      </button>
  </div>

  <!-- Alertas -->
  @if (successMsg()) {
    <div class="adm-alert success">âœ“ {{ successMsg() }}</div>
  }
  @if (errorMsg()) {
    <div class="adm-alert error">âœ• {{ errorMsg() }}</div>
  }

  <!-- â•â• FORMULARIO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  @if (showForm()) {
    <app-admin-drop-form 
      [editingDrop]="selectedDrop()" 
      [saving]="saving()"
      (save)="handleSave($event)"
      (cancel)="toggleForm()">
    </app-admin-drop-form>
  }

  <!-- â•â• LISTA DE DROPS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  @if (drops().length === 0) {
    <div class="adm-empty">
      <p>No hay drops creados todavÃ­a.</p>
    </div>
  }

  @for (drop of drops(); track drop.id) {
    <div class="drop-card" [class.inactive]="!drop.active">

      <!-- Hero thumbnail -->
      <div class="drop-card-img">
        @if (drop.hero_image) {
          <img [src]="drop.hero_image" [alt]="drop.label" />
        } @else {
          <div class="drop-card-img-placeholder">Sin imagen</div>
        }
        <div class="drop-card-accent" [style.background]="drop.accent_color"></div>
      </div>

      <!-- Info -->
      <div class="drop-card-body">
        <div class="drop-card-header">
          <div>
            <span class="drop-card-number">{{ drop.number }}</span>
            <h3 class="drop-card-label">{{ drop.label }}</h3>
            <p class="drop-card-tagline">{{ drop.tagline }}</p>
          </div>
          <span class="drop-badge" [class.active]="drop.active" [class.inactive]="!drop.active">
            {{ drop.active ? 'ACTIVO' : 'INACTIVO' }}
          </span>
        </div>

        <p class="drop-card-desc">{{ drop.description }}</p>

        <div class="drop-card-meta">
          <span>ðŸ“… {{ drop.release_date }}</span>
          <span>ðŸ‘• {{ drop.total_pieces }} piezas</span>
        </div>
      </div>

      <!-- Acciones -->
      <div class="drop-card-actions">
        <button
          class="adm-btn-toggle"
          [class.deactivate]="drop.active"
          [disabled]="toggling() === drop.id"
          (click)="toggleActive(drop)">
          @if (toggling() === drop.id) { ... }
          @else if (drop.active) { Desactivar }
          @else { Activar }
        </button>
        <button class="adm-btn-edit" (click)="editDrop(drop)">Editar</button>
        <button
          class="adm-btn-delete"
          [disabled]="deleting() === drop.id"
          (click)="deleteDrop(drop)">
          @if (deleting() === drop.id) { Eliminando... } @else { Eliminar }
        </button>
      </div>

    </div>
  }

</div>
