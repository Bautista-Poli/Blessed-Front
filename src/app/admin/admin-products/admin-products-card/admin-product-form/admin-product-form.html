<form class="pf-two-col" [formGroup]="form" (ngSubmit)="submit()">
  <!-- IZQ: FOTOS -->
  <section class="pf-col pf-col--photos">
    <p class="pf-section-label">Fotos del producto</p>
    <p class="pf-section-hint">La primera foto es la principal. Tocá “Siguiente” para subir y avanzar.</p>
    <div class="pf-slot-main">
      <app-image-upload-slot
        [label]="(index() + 1).toString()"
        [required]="index() < requiredCount"
        [value]="(previews()[index()] ?? imageUrls()[index()] ?? '')"
        (fileChange)="onFileSelected($event)"
      ></app-image-upload-slot>

      <div class="pf-wizard-actions">
        <button type="button" (click)="back()" [disabled]="index() === 0 || uploading()">Atrás</button>

        <button type="button" (click)="next()" [disabled]="uploading()">
          @if (uploading()) { Subiendo... {{ progress() }}% } @else { Siguiente }
        </button>
      </div>

      @if (index() === 0) {
        <span class="pf-slot-badge">Principal</span>
      }
    </div>

    <div class="pf-thumbs">
      @for (i of [0,1,2,3]; track i) {
        <div class="pf-thumb" [class.active]="i === index()">
          @if (imageUrls()[i] || previews()[i]) {
            <img [src]="(previews()[i] ?? imageUrls()[i])!" alt="thumb" />
          } @else {
            <span>{{ i + 1 }}</span>
          }
        </div>
      }
    </div>
  </section>

  <!-- DER: DATOS -->
  <section class="pf-col pf-col--data">
    <p class="pf-section-label">Información del producto</p>

    <div class="adm-form-grid">

      <!-- Nombre -->
      <div class="adm-field" [class.err]="fieldErr('name')">
        <label>Nombre</label>
        <input type="text" formControlName="name" placeholder='...' />
        @if (fieldErr('name')) { <span class="adm-err">Requerido</span> }
      </div>

      <!-- Categoría -->
      <div class="adm-field">
        <label>Categoría</label>
        <select formControlName="cat">
          @for (c of CATS; track c) {
            <option [value]="c">{{ c }}</option>
          }
        </select>
      </div>

      <!-- Drop -->
      <div class="adm-field" [class.err]="fieldErr('drop')">
        <label>Drop</label>
        <select formControlName="drop">
          @for (d of drops(); track d.id) {
            <option [value]="d.id">{{ d.label }}</option>
          }
        </select>
        @if (fieldErr('drop')) { <span class="adm-err">Requerido</span> }
      </div>

      <!-- Precio -->
      <div class="adm-field" [class.err]="fieldErr('price')">
        <label>Precio con descuento</label>
        <input type="number" formControlName="price" placeholder="0" />
        @if (fieldErr('price')) { <span class="adm-err">Ingresá un precio válido</span> }
      </div>

      <!-- Precio original -->
      <div class="adm-field" [class.err]="fieldErr('originalPrice')">
        <label>Precio original ARS</label>
        <input type="number" formControlName="originalPrice" placeholder="0" />
        @if (fieldErr('originalPrice')) { <span class="adm-err">Requerido</span> }
      </div>

      <!-- Flags -->
      <div class="adm-field adm-flags">
        <label class="adm-toggle">
          <input type="checkbox" formControlName="isNew" />
          <span class="adm-toggle-track"></span>
          <span>Es nuevo</span>
        </label>

        <label class="adm-toggle">
          <input type="checkbox" formControlName="isSale" />
          <span class="adm-toggle-track"></span>
          <span>En oferta</span>
        </label>
      </div>

      <!-- Descripción -->
      <div class="adm-field adm-field-wide">
        <label>Descripción <span class="adm-opt">(opcional)</span></label>
        <textarea
          formControlName="description"
          rows="3"
          placeholder="Descripción corta del producto..."
        ></textarea>
      </div>

    </div>

    <!-- Footer botones -->
    <div class="adm-form-footer">
      <button type="button" class="adm-btn-cancel" (click)="cancel()">
        Cancelar
      </button>

      <button type="submit" class="adm-btn-save" [disabled]="saving()">
        @if (saving()) { Guardando... } @else { Guardar producto }
      </button>
    </div>
  </section>
</form>
