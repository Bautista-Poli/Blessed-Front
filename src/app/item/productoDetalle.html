<!-- src/app/pages/producto-detalle/producto-detalle.html -->

<div class="pd-page">

  <!-- ══════════════════════════════════════════════
       BREADCRUMB
  ══════════════════════════════════════════════ -->
  <nav class="pd-breadcrumb">
    <a href="#">Inicio</a>
    <span>/</span>
    <a href="#">{{ product.cat }}</a>
    <span>/</span>
    <span>{{ product.name }}</span>
  </nav>

  <!-- ══════════════════════════════════════════════
       LAYOUT: GALERÍA | INFO
  ══════════════════════════════════════════════ -->
  <div class="pd-layout">

    <!-- ── GALERÍA ─────────────────────────────────────── -->
    <div class="pd-gallery">

      <!-- Thumbnails verticales (desktop) -->
      <div class="pd-thumbs">
        @for (img of images; track $index) {
          <button
            class="pd-thumb"
            [class.active]="activeImgIdx === $index"
            (click)="setImage($index)"
            [attr.aria-label]="'Foto ' + ($index + 1)"
          >
            <img [src]="img" [alt]="product.name" loading="lazy" />
          </button>
        }
      </div>

      <!-- Imagen principal con zoom -->
      <div class="pd-main-img-wrap">

        <div
          class="pd-main-img"
          [class.zoomed]="zoomActive"
          [style.--zx]="zoomX + '%'"
          [style.--zy]="zoomY + '%'"
          (click)="toggleZoom($event)" 
          (mousemove)="onImageMouseMove($event)"
        >
          <img [src]="activeImage" [alt]="product.name" />
        </div>

        <!-- Flechas navegación móvil -->
        <button class="pd-arrow pd-arrow--prev" (click)="prevImage()" aria-label="Foto anterior">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
        </button>
        <button class="pd-arrow pd-arrow--next" (click)="nextImage()" aria-label="Foto siguiente">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>

        <!-- Badges -->
        <div class="pd-badges">
          @if (product.badge) {
            <span class="pd-badge pd-badge--sale">{{ product.badge }}</span>
          }
        </div>

        <!-- Dots móvil -->
        <div class="pd-dots">
          @for (img of images; track $index) {
            <button
              class="pd-dot"
              [class.active]="activeImgIdx === $index"
              (click)="setImage($index)"
            ></button>
          }
        </div>

        <!-- Hint zoom desktop -->
        <span class="pd-zoom-hint">Pasá el cursor para hacer zoom</span>
      </div>

    </div>

    <!-- ── INFO + ACCIONES ──────────────────────────────── -->
    <div class="pd-info">

      <!-- Categoría -->
      <span class="pd-cat">{{ product.cat }}</span>

      <!-- Nombre -->
      <h1 class="pd-name">{{ product.name }}</h1>

      <!-- Precio -->
      <div class="pd-pricing">
        <span class="pd-price">{{ formatPrice(product.price) }}</span>
        @if (discount > 0) {
          <span class="pd-price-old">{{ formatPrice(product.originalPrice) }}</span>
          <span class="pd-discount">−{{ discount }}%</span>
        }
      </div>

      <!-- Cuotas -->
      <p class="pd-installments">
        3 cuotas sin interés de {{ installmentPrice }}
      </p>

      <!-- ─ COLORES ─────────────────────────────────────── -->
      <div class="pd-section">
        <div class="pd-section-label">
          <span>Color</span>
          <span class="pd-selected-val">{{ selectedColor.name }}</span>
        </div>
        <div class="pd-swatches">
          @for (c of product.colors; track $index) {
            <button
              class="pd-swatch"
              [class.active]="selectedColorIdx === $index"
              [style.background]="c.hex"
              [attr.aria-label]="c.name"
              (click)="selectColor($index)"
            ></button>
          }
        </div>
      </div>

      <!-- ─ TALLES ──────────────────────────────────────── -->
      <div class="pd-section">
        <div class="pd-section-label">
          <span>Talle</span>
          @if (selectedSize) {
            <span class="pd-selected-val">{{ selectedSize }}</span>
          } @else {
            <span class="pd-size-hint">Seleccioná un talle</span>
          }
        </div>
        <div class="pd-sizes">
          @for (s of product.sizes; track s) {
            <button
              class="pd-size"
              [class.active]="selectedSize === s"
              (click)="selectSize(s)"
            >
              {{ s }}
            </button>
          }
        </div>
        <a href="#" class="pd-size-guide">Guía de talles →</a>
      </div>

      <!-- ─ BOTÓN AGREGAR ───────────────────────────────── -->
      <button
        class="pd-add-btn"
        [class.added]="addedToBag"
        [class.no-size]="!selectedSize"
        (click)="onAddToCart()"
      >
        @if (addedToBag) {
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Agregado al carrito
        } @else {
          Agregar al carrito
        }
      </button>

      @if (!selectedSize) {
        <p class="pd-no-size-msg">Seleccioná un talle para continuar</p>
      }

      <!-- ─ DESCRIPCIÓN ─────────────────────────────────── -->
      <div class="pd-section pd-desc-section">
        <p class="pd-desc">{{ product.description }}</p>
      </div>

      <!-- ─ DETALLES ACORDEÓN ───────────────────────────── -->
      <div class="pd-accordion">
        <button class="pd-accordion-btn" (click)="toggleDetails()">
          <span>Composición y cuidado</span>
          <svg
            class="pd-accordion-icon"
            [class.open]="detailsOpen"
            width="16" height="16" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="1.5"
          >
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="pd-accordion-body" [class.open]="detailsOpen">
          <ul class="pd-details-list">
            @for (d of product.details; track d) {
              <li>{{ d }}</li>
            }
          </ul>
        </div>
      </div>

      <!-- ─ ENVÍO ───────────────────────────────────────── -->
      <div class="pd-shipping">
        <div class="pd-shipping-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="1" y="3" width="15" height="13" rx="1"/>
            <path d="M16 8h4l3 5v3h-7V8z"/>
            <circle cx="5.5" cy="18.5" r="2.5"/>
            <circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span>Envío gratis en compras +$50.000</span>
        </div>
        <div class="pd-shipping-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          <span>Devolución gratis en 30 días</span>
        </div>
      </div>

    </div>
  </div>

</div>
