<!-- src/app/item/productoDetalle.html -->
@if (loading) {
  <div class="pd-loading">Cargando...</div>
} @else if (notFound) {
  <div class="pd-not-found">Producto no encontrado.</div>
} @else if (product) {

<div class="pd-page">

  <!-- BREADCRUMB -->
  <nav class="pd-breadcrumb">
    <a routerLink="/">Inicio</a>
    <span>/</span>
    <a routerLink="/catalog">{{ product.cat }}</a>
    <span>/</span>
    <span>{{ product.name }}</span>
  </nav>
  <div class="pd-logo-container">
    <a [routerLink]="['/']" class="nav-logo-link">
      <img src="assets/Logo2.webp" alt="Blessed Logo" class="logo-img" />
    </a>
  </div>

  <!-- LAYOUT -->
  <div class="pd-layout">

    <!-- ── GALERÍA ──────────────────────────────────────── -->
    <div class="pd-gallery">

      <!-- Thumbnails verticales -->
      <div class="pd-thumbs">
        @for (img of images; track $index) {
          <button
            class="pd-thumb"
            [class.active]="activeImgIdx === $index"
            (click)="setImage($index)"
            [attr.aria-label]="'Foto ' + ($index + 1)">
            <img [src]="img" [alt]="product.name" loading="lazy" />
          </button>
        }
      </div>

      <!-- Imagen principal -->
      <div class="pd-main-img-wrap">
        <div class="pd-main-img">
        <img [src]="activeImage" [alt]="product.name" />
      </div>

        <!-- Flechas móvil -->
        <button class="pd-arrow pd-arrow--prev" (click)="prevImage()" aria-label="Foto anterior">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
        </button>
        <button class="pd-arrow pd-arrow--next" (click)="nextImage()" aria-label="Foto siguiente">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>

        

        <!-- Dots móvil -->
        <div class="pd-dots">
          @for (img of images; track $index) {
            <button
              class="pd-dot"
              [class.active]="activeImgIdx === $index"
              (click)="setImage($index)">
            </button>
          }
        </div>

      </div>

    </div>

    <!-- ── INFO ─────────────────────────────────────────── -->
    <div class="pd-info">

      <span class="pd-cat">{{ product.cat }}</span>
      <h1 class="pd-name">{{ product.name }}</h1>

      <!-- Precio -->
      <div class="pd-pricing">
        <span class="pd-price">{{ formatPrice(product.price) }}</span>
        @if (discount > 0) {
          <span class="pd-price-old">{{ formatPrice(product.originalPrice) }}</span>
          <span class="pd-discount">−{{ discount }}%</span>
        }
      </div>

      <p class="pd-installments">3 cuotas sin interés de {{ installmentPrice }}</p>

      <!-- Colores -->
      @if (product.colors.length > 0) {
        <div class="pd-section">
          <div class="pd-section-label">
            <span>Color</span>
            <span class="pd-selected-val">{{ selectedColor.name }}</span>
          </div>
          <div class="pd-swatches">
            @for (c of product.colors; track $index) {
              <button
                class="pd-swatch"
                [class.active]="selectedColorIdx === $index"
                [style.background]="c.hex"
                [attr.aria-label]="c.name"
                (click)="selectColor($index)">
              </button>
            }
          </div>
        </div>
      }

      <!-- Talles -->
      <div class="pd-section">
        <div class="pd-section-label">
          <span>Talle</span>
          @if (selectedSize) {
            <span class="pd-selected-val">{{ selectedSize }}</span>
          } @else {
            <span class="pd-size-hint">Seleccioná un talle</span>
          }
        </div>
        <div class="pd-sizes">
          @for (s of availableSizes; track s) {
            <button
              class="pd-size"
              [class.active]="selectedSize === s"
              (click)="selectSize(s)">
              {{ s }}
            </button>
          }
        </div>
        <a href="#" class="pd-size-guide">Guía de talles →</a>
      </div>

      <!-- Botón agregar -->
      <button
        class="pd-add-btn"
        [class.added]="addedToBag"
        [class.no-size]="!selectedSize"
        (click)="onAddToCart()">
        @if (addedToBag) {
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Agregado al carrito
        } @else {
          Agregar al carrito
        }
      </button>

      @if (!selectedSize) {
        <p class="pd-no-size-msg">Seleccioná un talle para continuar</p>
      }

      <!-- Descripción -->
      @if (product.description) {
        <div class="pd-section pd-desc-section">
          <p class="pd-desc">{{ product.description }}</p>
        </div>
      }

      <!-- Acordeón composición -->
      <div class="pd-accordion">
        <button class="pd-accordion-btn" (click)="toggleDetails()">
          <span>Composición y cuidado</span>
          <svg
            class="pd-accordion-icon"
            [class.open]="detailsOpen"
            width="16" height="16" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="1.5">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="pd-accordion-body" [class.open]="detailsOpen">
          <ul class="pd-details-list">
            <li>100% algodón premium</li>
            <li>Lavable a máquina en frío</li>
            <li>No usar secadora</li>
            <li>Planchado a baja temperatura</li>
          </ul>
        </div>
      </div>

      <!-- Envío -->
      <div class="pd-shipping">
        <div class="pd-shipping-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="1" y="3" width="15" height="13" rx="1"/>
            <path d="M16 8h4l3 5v3h-7V8z"/>
            <circle cx="5.5" cy="18.5" r="2.5"/>
            <circle cx="18.5" cy="18.5" r="2.5"/>
          </svg>
          <span>Envío gratis en compras +$50.000</span>
        </div>
        <div class="pd-shipping-item">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          <span>Devolución gratis en 30 días</span>
        </div>
      </div>

    </div>
  </div>

</div>

}
